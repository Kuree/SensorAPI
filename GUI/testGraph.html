<!doctype>
<link type="text/css" rel="stylesheet" href="Content/rickshaw.min.css">
<script src="Scripts/d3.min.js"></script>
<script src="Scripts/rickshaw.min.js"></script>
<script src="Scripts/jquery-2.1.1.min.js"></script>

<body>
    <div id="chart_container">
        <div id="chart"></div>
        <div id="y_axis"></div>
    </div>
</body>
<style>
    #chart_container {
        position: relative;
        font-family: Arial, Helvetica, sans-serif;
    }

    #chart {
        position: relative;
        left: 40px;
    }

    #y_axis {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 40px;
    }
</style>


<script>
    function test() {
        queryData =
            {
                "start": 1400000000,
                "end": 1403107250,
                "queries": [{
                    "aggregator": "max",

                    "metric": "Table",
                    "rate": false,
                    "tags": {
                        "sensor_name": "BattV",
                        "sensor_units": "Volts",
                        "sensor_processing": "Smp"
                    },
                    "downsample": "1h-max"
                },
                {
                    "aggregator": "max",

                    "metric": "Table",
                    "rate": false,
                    "tags": {
                        "sensor_name": "BattV",
                        "sensor_units": "Volts",
                        "sensor_processing": "Smp"
                    },
                    "downsample": "1h-max"
                },
                {
                    "aggregator": "max",

                    "metric": "Table",
                    "rate": false,
                    "tags": {
                        "sensor_name": "BattV",
                        "sensor_units": "Volts",
                        "sensor_processing": "Smp"
                    },
                    "downsample": "1h-max"
                },
                {
                    "aggregator": "max",

                    "metric": "Table",
                    "rate": false,
                    "tags": {
                        "sensor_name": "BattV",
                        "sensor_units": "Volts",
                        "sensor_processing": "Smp"
                    },
                    "downsample": "1h-max"
                }]
            }
        try {
            $.ajax({
                url: "http://localhost:8888/rickshaw",
                dataType: "json",
                error: showError,
                success: createGraph,
                crossDomain: true,
                data: JSON.stringify(queryData),
                type: 'POST'
                //contentType: "application/json; charset=utf-8"
            });
        }
        catch (err) {
            console.log(err.stack);
        }
    }
    function showError(error) {
        console.log(error.responseText);
    };
    function createGraph(data, status, jqXHRob) {
        console.log("creating graph...")
        
        console.log(data)
        /* Scheme:
        #e41a1c
        #377eb8
        #4daf4a
        #984ea3
        #ff7f00
        #ffff33
        #a65628
        */
        var graph = new Rickshaw.Graph({
            renderer: 'line',
            element: document.querySelector("#chart"),
            width: 580,
            height: 250,
            unstack: true,
            series: [
            {
                name: "Athletic Center Demand",
                color: '#e41a1c',
                data: data[0]["Table.sensor_name:BattV.sensor_processing:Smp.sensor_units:Volts"]
            }]
        });
        var y_ticks = new Rickshaw.Graph.Axis.Y({
            graph: graph,
            orientation: 'left',
            tickFormat: Rickshaw.Fixtures.Number.formatKMBT,
            pixelsPerTick: 60,
            element: document.getElementById('y_axis'),
        });

        graph.render();

        var x_axis = new Rickshaw.Graph.Axis.Time({
            graph: graph
        });

        x_axis.render();

        var hoverDetail = new Rickshaw.Graph.HoverDetail({
            graph: graph
        });

        graph.render()
        
    }
    test()
</script>